## 硬件连接

### 引脚分配

| 功能模块 | 引脚号 | 说明 |
|---------|-------|------|
| I2C SDA | 8 | OLED和颜色传感器数据线 |
| I2C SCL | 9 | OLED和颜色传感器时钟线 |
| 颜色传感器LED | 10 | 颜色传感器LED控制 |
| 雾化片 | 4 | 雾化片信号线 |
| OLED复位 | -1 | OLED复位引脚（不使用） |
| MQ-9传感器 | 3 | MQ-9模拟输入引脚 |
| 蜂鸣器 | 15 | 蜂鸣器控制引脚 |
| 红色LED | 16 | 红色LED控制引脚 |

### 接线图

```
+----------------------------------------+
|                ESP32                   |
+----------------------------------------+
| 引脚8 (SDA)  --> OLED/颜色传感器 SDA    |
| 引脚9 (SCL)  --> OLED/颜色传感器 SCL    |
| 引脚10       --> 颜色传感器 LED         |
| 引脚4        --> 雾化片控制             |
| 引脚3        --> MQ-9传感器信号        |
| 引脚15       --> 蜂鸣器控制             |
| 引脚16       --> 红色LED控制            |
| 5V/3.3V      --> 电源输入               |
| GND          --> 接地                   |
+----------------------------------------+
```

## 设备配置

### 1. 初次启动与WiFi配置

#### 方法一：AP配网模式

1. 设备初次启动时，自动进入AP配网模式
2. 使用手机或电脑搜索WiFi热点，找到名称为`ESP32_Fogger_Control`的热点
3. 连接该热点，默认密码为`无`
4. 打开浏览器，输入地址`192.168.4.1`，进入配网页面
5. 在配网页面中输入要连接的WiFi名称和密码
6. 点击"保存"按钮，设备将自动重启并连接到指定的WiFi网络
7. 设备重启后，OLED显示屏将显示分配的IP地址

#### 方法二：WiFi重置

如果需要重新配置WiFi，可按照以下步骤操作：

1. 按住设备上的BOOT按键不放
2. 短按一次RST按键
3. 等待约3秒后松开所有按键
4. 设备将重置WiFi配置并进入AP配网模式
5. 重复AP配网模式的步骤3-7

### 2. 查看设备IP地址

设备成功连接WiFi后，可通过以下方式查看IP地址：

1. **OLED显示屏**：直接查看设备OLED屏幕上显示的IP地址
2. **路由器管理界面**：登录路由器管理后台，在设备列表中查找名称为`ESP32_Fogger_Control`的设备
3. **手机WiFi设置**：在手机的WiFi连接列表中查看已连接设备的IP地址

### 3. 系统参数配置

通过Web界面可进行以下系统参数配置：

1. **WiFi参数**：修改WiFi连接配置、热点参数
2. **报警阈值**：设置MQ-9传感器的报警阈值
3. **LED模式**：配置LED灯的工作模式
4. **采样频率**：调整传感器数据采样频率
5. **数据记录**：开启/关闭数据记录功能

## Web界面操作

### 1. 访问Web界面

在浏览器中输入设备的IP地址，即可进入Web控制界面。建议使用Chrome、Firefox、Edge等现代浏览器。

### 2. 首页概览

首页显示设备的关键状态信息，包括：

- 设备连接状态
- 雾化片运行状态
- WiFi连接状态
- 气体浓度值
- 报警状态
- 颜色传感器状态

### 3. 雾化片控制

在Web界面的"雾化控制"标签页中，您可以：

- 点击"启动"按钮启动雾化片
- 点击"停止"按钮停止雾化片
- 查看雾化片当前运行状态
- 设置雾化片自动运行规则

### 4. LED控制

在"LED控制"标签页中，您可以：

- 控制LED灯的开关
- 选择LED灯的工作模式（常亮、熄灭、闪烁）
- 调整闪烁频率

### 5. WiFi配置

在"WiFi配置"标签页中，您可以：

- 查看当前WiFi连接状态和信号强度
- 修改WiFi连接配置（SSID、密码）
- 配置设备热点参数（名称、密码、加密方式）
- 重置WiFi配置

### 6. 安全状态监测

在"安全监测"标签页中，您可以：

- 查看MQ-9传感器的实时气体浓度值
- 查看报警状态和历史报警记录
- 查看传感器校准状态
- 配置报警阈值和报警方式

### 7. 传感器校准

#### MQ-9传感器校准

MQ-9传感器支持零点校准和跨度校准，可通过Web界面进行操作：

1. 点击"开始校准"按钮进入校准模式
2. 在清洁空气中，点击"零点校准"进行零点校准
3. 通入已知浓度的标准气体，点击"跨度校准"进行跨度校准
4. 点击"保存校准"保存校准系数
5. 点击"应用校准"应用校准系数

#### 颜色传感器校准

在"颜色校准"标签页中，您可以：

- 查看当前检测到的颜色RGB值
- 进行颜色传感器校准
- 查看校准状态
- 配置颜色检测参数

### 8. 数据记录与分析

Web界面提供数据记录和趋势分析功能：

- 实时显示气体浓度、颜色变化等数据
- 提供可视化图表，支持不同时间范围的数据查看
- 支持数据导出（JSON格式）
- 支持数据导入和恢复

## 日常操作

### 1. 开机操作

1. 检查所有连接是否牢固
2. 连接设备电源
3. 观察OLED显示屏，确认设备正常启动
4. 检查WiFi连接状态，获取IP地址
5. 通过Web界面登录并确认各项功能正常

### 2. 关机操作

1. 通过Web界面停止雾化片运行
2. 断开设备电源
3. 如需长期不使用，建议断开所有连接

### 3. 雾化片操作

- **手动模式**：通过Web界面的"启动"/"停止"按钮控制雾化片
- **自动模式**：设备根据MQ-9传感器检测结果自动控制雾化片启停

### 4. 定期检查

- 每日检查：观察OLED显示屏，确认设备运行状态正常
- 每周检查：检查传感器连接是否牢固，清洁传感器表面灰尘
- 每月检查：校准MQ-9传感器，确保检测准确性

## 自动运行模式

设备具有自动运行模式，无需人工干预即可完成各项功能：

1. **气体浓度监测**：MQ-9传感器实时监测环境中的可燃气体浓度
2. **安全报警机制**：当气体浓度超过设定阈值时，系统自动触发以下操作：
   - 蜂鸣器发出连续报警声
   - 红色LED快速闪烁
   - 自动停止雾化片工作
   - 记录报警事件
3. **状态显示**：OLED显示屏实时更新设备状态和IP地址
4. **Web请求处理**：响应远程控制请求，支持实时状态查询
5. **数据记录**：自动记录传感器数据，支持趋势分析

## 维护保养

### 1. 日常维护

- **清洁设备**：使用干燥的软布擦拭设备表面，避免使用腐蚀性清洁剂
- **清洁传感器**：定期使用压缩空气清洁MQ-9传感器和颜色传感器表面的灰尘
- **检查连接**：定期检查所有连接线是否牢固，避免松动或接触不良
- **更换雾化片**：根据使用频率，定期更换雾化片（建议每3-6个月更换一次）

### 2. 传感器校准

- **MQ-9传感器**：建议每月校准一次，确保检测准确性
- **颜色传感器**：根据使用环境和精度要求，每1-3个月校准一次

### 3. 固件升级

1. 通过Web界面检查设备固件版本
2. 如需升级，下载最新固件文件
3. 在Web界面的"系统升级"标签页中上传固件文件
4. 等待设备自动升级并重启
5. 升级完成后，检查各项功能是否正常

### 4. 常见维护问题

| 维护项目 | 维护周期 | 维护方法 |
|---------|---------|---------|
| 设备清洁 | 每周 | 干燥软布擦拭 |
| 传感器清洁 | 每两周 | 压缩空气吹扫 |
| MQ-9校准 | 每月 | Web界面校准 |
| 雾化片更换 | 3-6个月 | 更换新雾化片 |
| 固件升级 | 按需 | Web界面升级 |

## 常见问题解答

### 1. 设备无法连接WiFi怎么办？

- 检查WiFi名称和密码是否正确输入
- 确认WiFi信号强度足够，设备与路由器距离不宜过远
- 检查路由器是否开启了MAC地址过滤
- 尝试重启设备和路由器
- 尝试重置WiFi配置，重新进入AP配网模式

### 2. 无法访问Web界面怎么办？

- 确认设备已成功连接WiFi网络
- 检查设备IP地址是否正确
- 确认电脑或手机与设备在同一局域网内
- 尝试关闭浏览器缓存或使用隐私模式访问
- 检查防火墙设置，确保未阻止对设备的访问

### 3. 雾化片不工作怎么办？

- 检查雾化片是否正确连接到GPIO4引脚
- 确认雾化片是否损坏，尝试更换新的雾化片
- 检查是否因气体浓度超标触发了安全保护
- 通过Web界面检查雾化片控制状态

### 4. 气体传感器报警不准确怎么办？

- 尝试重新校准MQ-9传感器
- 确保传感器在正常工作环境中（温度、湿度适宜）
- 检查传感器是否老化，必要时更换新传感器
- 确认报警阈值设置是否合理

### 5. OLED显示屏不显示怎么办？

- 检查OLED显示屏是否正确连接
- 确认I2C引脚（SDA、SCL）连接是否正确
- 重启设备尝试
- 检查OLED显示屏是否损坏

### 6. 颜色传感器检测不准确怎么办？

- 尝试重新校准颜色传感器
- 确保传感器LED正常工作
- 检查传感器与检测物体的距离是否合适
- 避免外界强光干扰

## 故障排除

| 故障现象 | 可能原因 | 解决方法 |
|---------|---------|---------|
| 设备无法启动 | 电源问题 | 检查电源连接，确保电压在3.3V-5V范围内 |
| WiFi连接失败 | WiFi配置错误 | 重置WiFi配置，重新进入AP配网模式 |
| Web界面无法访问 | IP地址错误或网络问题 | 重新获取设备IP地址，确认网络连接正常 |
| 雾化片不工作 | 引脚连接错误或雾化片损坏 | 检查雾化片引脚连接，尝试更换新雾化片 |
| 气体传感器无数据 | 传感器连接错误或未校准 | 检查传感器连接，重新校准传感器 |
| 气体传感器报警频繁 | 传感器未校准或环境问题 | 重新校准传感器，检查使用环境 |
| OLED不显示 | I2C连接错误或显示屏损坏 | 检查I2C引脚连接，尝试更换OLED显示屏 |
| 蜂鸣器不响 | 蜂鸣器引脚错误或蜂鸣器损坏 | 检查蜂鸣器引脚连接，尝试更换蜂鸣器 |
| 颜色传感器检测不准确 | 传感器未校准或强光干扰 | 重新校准传感器，避免外界强光干扰 |
| LED灯不亮 | LED引脚错误或LED损坏 | 检查LED引脚连接，尝试更换LED灯 |

## 技术规格

| 技术参数 | 规格 |
|---------|------|
| 主控制器 | ESP32-WROOM-32 |
| 工作电压 | 3.3V-5V DC |
| 工作电流 | 最大500mA |
| 工作温度 | -40℃~85℃ |
| 相对湿度 | 10%~90%（非凝结） |
| WiFi标准 | 802.11 b/g/n |
| WiFi频率 | 2.4GHz |
| MQ-9传感器 | 检测范围：0-1000ppm |
| OLED显示屏 | 128x64像素，I2C接口 |
| 蜂鸣器 | 无源蜂鸣器 |
| 颜色传感器 | TCS3200或兼容型号 |
| 通信接口 | I2C、GPIO |
| 外壳材质 | ABS塑料 |

## 注意事项

1. **安全使用**：设备使用过程中，请勿覆盖或遮挡MQ-9传感器，确保气体检测准确性
2. **定期校准**：定期校准MQ-9传感器，建议每月校准一次，确保检测精度
3. **环境要求**：设备应放置在通风良好的环境中使用，避免在密闭空间长时间运行
4. **防水防潮**：请勿将设备暴露在水或潮湿环境中，防止短路损坏
5. **高温防护**：设备工作时，请勿触摸雾化片，以免烫伤
6. **定期检查**：定期检查设备各部件连接，确保正常工作
7. **远离干扰**：避免设备靠近强电磁干扰源，如微波炉、大功率电机等
8. **固件升级**：定期检查并升级设备固件，获取最新功能和安全补丁
9. **数据备份**：定期备份重要的校准数据和配置参数
10. **专业维修**：设备出现故障时，请勿自行拆解维修，建议联系专业技术人员

## 版本信息

- 版本：V1.0
- 发布日期：2026-01-01
- 适用设备：ESP32-WROOM-32
- 主要功能：
  - 雾化片控制
  - WiFi连接与Web控制
  - MQ-9气体检测与报警
  - OLED状态显示
  - 颜色传感器支持
  - 数据记录与趋势分析
-

**ESP32智能雾化控制系统操作说明书** - 版权所有 © 2026
